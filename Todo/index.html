<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Todo</title>
  </head>
  <body>
    <h1>Things ToDo</h1>
    <div id="tasklist"></div>
    <div>
      <input type="text" id="tdName" />
      <button id="tdAdd">Add Task</button>
    </div>

    <script type="application/javascript">
      const elTasks = document.getElementById("tasklist");

      let getTododos = async () => {
        elTasks.innerHTML = "";
      };

      (async () => {
        const addBtn = document.getElementById("tdAdd");
        addBtn.addEventListener("click", () => {
          const tdText = document.getElementById("tdName");

          console.log(tdText.value);

          let data = { name: tdText.value, isComplete: false };
        });

        const itemsRaw = await fetch("https://localhost:5001/api/todo/", {
          cache: "no-cache",
          method: "GET"
        });
        const items = await itemsRaw.json();

        items.forEach(tdi => {
          const elTDi = document.createElement("div");

          elTDi.id = tdi.id;

          elTDi.innerHTML =
            '<input class="tdiCheck" type="checkbox" name="isComplete"' +
            (tdi.isComplete ? "checked" : "") +
            'value="isComplete" />' +
            "<span>" +
            tdi.name +
            "</span>";
          elTasks.appendChild(elTDi);
        });

        let elsChecks = document.querySelectorAll(".tdiCheck");

        elsChecks.forEach(el => {
          el.addEventListener("click", async e => {
            console.log(el, el.parentElement.id);
            const itemsRaw = await fetch(
              "https://localhost:5001/api/todo/" + el.parentElement.id,
              {
                method: "PATCH",
                headers: {
                  Accept: "application/json",
                  "Content-Type": "application/json"
                },
                body: JSON.stringify({
                  id: el.parentElement.id,
                  isComplete: el.checked
                })
              }
            );
          });
        });

        console.log(items);
      })();
    </script>
  </body>
</html>
